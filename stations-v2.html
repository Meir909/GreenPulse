<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GreenPulse - –ù–∞—à–∏ —Å—Ç–∞–Ω—Ü–∏–∏</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%);
            color: #ffffff;
        }

        /* Navigation */
        nav {
            background: rgba(10, 14, 39, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px 0;
            border-bottom: 1px solid rgba(16, 185, 129, 0.2);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        nav .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #10b981;
        }

        nav a {
            color: #b0b9d0;
            text-decoration: none;
            margin: 0 20px;
            transition: color 0.3s;
            font-size: 14px;
        }

        nav a:hover, nav a.active {
            color: #10b981;
        }

        /* Main */
        main {
            padding: 40px 0;
            min-height: calc(100vh - 80px);
        }

        h1 {
            font-size: 32px;
            color: #10b981;
            margin-bottom: 30px;
            text-align: center;
        }

        /* Map Section */
        .map-section {
            background: rgba(16, 185, 129, 0.05);
            border: 1px solid rgba(16, 185, 129, 0.2);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 40px;
            overflow: hidden;
        }

        #map {
            width: 100%;
            height: 500px;
            border-radius: 10px;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-box {
            background: rgba(16, 185, 129, 0.1);
            border-left: 4px solid #10b981;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #10b981;
            margin: 8px 0;
        }

        .stat-label {
            font-size: 12px;
            color: #b0b9d0;
        }

        /* Footer */
        footer {
            background: rgba(10, 14, 39, 0.8);
            border-top: 1px solid rgba(16, 185, 129, 0.2);
            padding: 30px 0;
            text-align: center;
            color: #b0b9d0;
            margin-top: 60px;
            font-size: 13px;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 15px;
        }

        .footer-links a {
            color: #10b981;
            text-decoration: none;
        }

        .footer-links a:hover {
            color: #34d399;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: linear-gradient(135deg, #1a1f3a 0%, #242b48 100%);
            margin: 10% auto;
            padding: 30px;
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(16, 185, 129, 0.2);
            padding-bottom: 15px;
        }

        .modal-title {
            font-size: 24px;
            color: #10b981;
            margin: 0;
        }

        .close {
            font-size: 28px;
            font-weight: bold;
            color: #b0b9d0;
            cursor: pointer;
            transition: color 0.3s;
        }

        .close:hover {
            color: #10b981;
        }

        .modal-section {
            margin: 20px 0;
            padding: 15px;
            background: rgba(16, 185, 129, 0.08);
            border-left: 3px solid #10b981;
            border-radius: 8px;
        }

        .modal-section-title {
            color: #34d399;
            font-weight: bold;
            margin-bottom: 12px;
            font-size: 14px;
        }

        .modal-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 10px;
        }

        .info-item {
            font-size: 12px;
        }

        .info-label {
            color: #b0b9d0;
            margin-bottom: 4px;
        }

        .info-value {
            color: #34d399;
            font-weight: bold;
            font-size: 16px;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
            margin: 5px 0;
        }

        .status-active {
            background: rgba(16, 185, 129, 0.3);
            color: #10b981;
        }

        .status-repair {
            background: rgba(245, 158, 11, 0.3);
            color: #fbbf24;
        }

        .status-inspect {
            background: rgba(59, 130, 246, 0.3);
            color: #60a5fa;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            margin: 8px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #34d399);
            border-radius: 3px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            h1 { font-size: 24px; }
            nav a { margin: 0 10px; font-size: 12px; }
            #map { height: 350px; }
            .modal-info { grid-template-columns: 1fr; }
            .modal-content { width: 95%; margin: 30% auto; }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav>
        <div class="container">
            <div class="logo">üí® GreenPulse</div>
            <div>
                <a href="stations-v2.html" class="active">üìä –°—Ç–∞–Ω—Ü–∏–∏</a>
                <a href="index-project-v2.html">‚ÑπÔ∏è –û –ü—Ä–æ–µ–∫—Ç–µ</a>
            </div>
        </div>
    </nav>

    <!-- Main -->
    <main>
        <div class="container">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
                <h1 style="margin: 0;">üó∫Ô∏è –ö–∞—Ä—Ç–∞ –Ω–∞—à–∏—Ö —Å—Ç–∞–Ω—Ü–∏–π –æ—á–∏—Å—Ç–∫–∏ –≤–æ–∑–¥—É—Ö–∞</h1>
                <button onclick="toggleAIFunctions()" style="padding: 10px 20px; background: linear-gradient(135deg, #10b981, #34d399); border: none; border-radius: 8px; color: #0a0e27; cursor: pointer; font-weight: bold; font-size: 14px;">ü§ñ –ò–ò –§—É–Ω–∫—Ü–∏–∏</button>
            </div>

            <!-- Map -->
            <div class="map-section">
                <div id="map"></div>
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-label">üìä –í—Å–µ–≥–æ —Å—Ç–∞–Ω—Ü–∏–π</div>
                        <div class="stat-value">1</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">‚úÖ –ê–∫—Ç–∏–≤–Ω—ã—Ö</div>
                        <div class="stat-value">1</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">üíö CO‚ÇÇ/–≥–æ–¥</div>
                        <div class="stat-value">38 –∫–≥</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">üë• –õ—é–¥–µ–π</div>
                        <div class="stat-value">15K</div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal -->
    <div id="stationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">–°—Ç–∞–Ω—Ü–∏—è</h2>
                <span class="close">&times;</span>
            </div>

            <!-- Status Section -->
            <div class="modal-section">
                <div class="modal-section-title">üîß –°—Ç–∞—Ç—É—Å —Å—Ç–∞–Ω—Ü–∏–∏</div>
                <div id="statusContent"></div>
            </div>

            <!-- Physical State -->
            <div class="modal-section">
                <div class="modal-section-title">üå°Ô∏è –§–∏–∑–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</div>
                <div class="modal-info">
                    <div class="info-item">
                        <div class="info-label">pH</div>
                        <div class="info-value" id="modalPh">6.50</div>
                        <div class="progress-bar"><div class="progress-fill" style="width: 50%;"></div></div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</div>
                        <div class="info-value" id="modalTemp">22¬∞C</div>
                    </div>
                </div>
            </div>

            <!-- Performance -->
            <div class="modal-section">
                <div class="modal-section-title">üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</div>
                <div class="modal-info">
                    <div class="info-item">
                        <div class="info-label">CO‚ÇÇ –æ—á–∏—â–µ–Ω–æ (–¥–µ–Ω—å)</div>
                        <div class="info-value">104 –º–≥</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">CO‚ÇÇ –æ—á–∏—â–µ–Ω–æ (–≥–æ–¥)</div>
                        <div class="info-value">38 –∫–≥</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</div>
                        <div class="info-value">92%</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">–°—Ç–∞—Ç—É—Å</div>
                        <div class="info-value">‚úÖ –ê–∫—Ç–∏–≤–Ω–∞</div>
                    </div>
                </div>
            </div>

            <!-- Coverage -->
            <div class="modal-section">
                <div class="modal-section-title">üìç –ó–æ–Ω–∞ –æ—Ö–≤–∞—Ç–∞</div>
                <div class="modal-info">
                    <div class="info-item">
                        <div class="info-label">–†–∞–¥–∏—É—Å –¥–µ–π—Å—Ç–≤–∏—è</div>
                        <div class="info-value">0.8 –∫–º</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">–ü–ª–æ—â–∞–¥—å</div>
                        <div class="info-value">2.01 –∫–º¬≤</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">–ù–∞—Å–µ–ª–µ–Ω–∏–µ</div>
                        <div class="info-value">15,000 —á–µ–ª</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">–ß–∏—Å—Ç—ã–π –≤–æ–∑–¥—É—Ö</div>
                        <div class="info-value">15K –ª—é–¥–µ–π</div>
                    </div>
                </div>
            </div>

            <!-- AI Forecast -->
            <div class="modal-section">
                <div class="modal-section-title">ü§ñ –ü—Ä–æ–≥–Ω–æ–∑ –ò–ò</div>
                <p style="font-size: 13px; color: #b0b9d0; line-height: 1.6;">
                    –ù–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—É—â–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Å—Ç–∞–Ω—Ü–∏—è –ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É –≤ —Ç–µ—á–µ–Ω–∏–µ 12 –º–µ—Å—è—Ü–µ–≤.
                    –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –∫–∞–∂–¥—ã–µ 6 –º–µ—Å—è—Ü–µ–≤ –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.
                </p>
            </div>
        </div>
    </div>

    <!-- AI Functions Section -->
    <div id="aiFunctions" style="display: none; margin-top: 60px; padding: 40px 0;">
        <div class="container">
            <!-- Tabs Navigation -->
            <div style="display: flex; gap: 10px; margin-bottom: 30px; flex-wrap: wrap; border-bottom: 1px solid rgba(16, 185, 129, 0.2); padding-bottom: 15px;">
                <button onclick="switchTab('chatbot')" class="ai-tab active" style="padding: 10px 20px; background: rgba(16, 185, 129, 0.2); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 5px; color: #10b981; cursor: pointer; font-size: 14px;">üí¨ –ß–∞—Ç-–±–æ—Ç</button>
                <button onclick="switchTab('sensors')" class="ai-tab" style="padding: 10px 20px; background: transparent; border: 1px solid rgba(16, 185, 129, 0.2); border-radius: 5px; color: #b0b9d0; cursor: pointer; font-size: 14px;">üìä –ê–Ω–∞–ª–∏–∑ –¥–∞—Ç—á–∏–∫–æ–≤</button>
                <button onclick="switchTab('prediction')" class="ai-tab" style="padding: 10px 20px; background: transparent; border: 1px solid rgba(16, 185, 129, 0.2); border-radius: 5px; color: #b0b9d0; cursor: pointer; font-size: 14px;">ü§ñ –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ —Ä–æ—Å—Ç–∞</button>
            </div>

            <!-- Chatbot Tab -->
            <div id="chatbot-tab" class="ai-tab-content" style="display: block;">
                <style>
                    @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
                    @keyframes messageAppear { from { opacity: 0; transform: scale(0.95) translateY(10px); } to { opacity: 1; transform: scale(1) translateY(0); } }
                    @keyframes neonGlow { 0%, 100% { box-shadow: 0 0 10px rgba(16, 185, 129, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1); } 50% { box-shadow: 0 0 20px rgba(16, 185, 129, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.2); } }
                    @keyframes buttonPulse { 0%, 100% { box-shadow: 0 4px 20px rgba(16, 185, 129, 0.3); } 50% { box-shadow: 0 4px 30px rgba(16, 185, 129, 0.5), 0 0 20px rgba(16, 185, 129, 0.3); } }

                    #chatContainer::-webkit-scrollbar { width: 6px; }
                    #chatContainer::-webkit-scrollbar-track { background: rgba(16, 185, 129, 0.05); border-radius: 10px; }
                    #chatContainer::-webkit-scrollbar-thumb { background: linear-gradient(180deg, #10b981, #34d399); border-radius: 10px; box-shadow: 0 0 10px rgba(16, 185, 129, 0.2); }

                    .chat-message-user { animation: messageAppear 0.4s ease-out; }
                    .chat-message-bot { animation: messageAppear 0.5s ease-out; }
                </style>

                <div style="margin-bottom: 30px;">
                    <h2 style="margin: 0 0 8px 0; font-size: 28px; background: linear-gradient(135deg, #10b981 0%, #34d399 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-weight: 700;">üí¨ –ß–∞—Ç-–±–æ—Ç GreenPulse</h2>
                    <p style="color: #b0b9d0; margin: 0; font-size: 14px; line-height: 1.5;">–ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –ø—Ä–æ –ø—Ä–æ–µ–∫—Ç, –±–∞–ª–¥—ã—Ä–∏ –∏–ª–∏ —ç–∫–æ–ª–æ–≥–∏—é - –ò–ò –æ—Ç–≤–µ—Ç–∏—Ç –æ—Ç –∏–º–µ–Ω–∏ GreenPulse</p>
                </div>

                <div id="chatContainer" style="
                    background: linear-gradient(135deg, rgba(16, 185, 129, 0.08) 0%, rgba(52, 211, 153, 0.04) 100%);
                    border: 1.5px solid rgba(16, 185, 129, 0.25);
                    border-radius: 16px;
                    padding: 24px;
                    height: 480px;
                    overflow-y: auto;
                    margin-bottom: 24px;
                    box-shadow: 0 8px 32px rgba(16, 185, 129, 0.1), inset 0 1px 0 rgba(52, 211, 153, 0.2);
                    position: relative;
                    backdrop-filter: blur(10px);
                    animation: neonGlow 3s ease-in-out infinite;
                ">
                    <div style="text-align: center; color: #b0b9d0; padding: 80px 20px; font-size: 14px; letter-spacing: 0.5px;">
                        ‚ú® –ù–∞—á–Ω–∏—Ç–µ —Ä–∞–∑–≥–æ–≤–æ—Ä - –≤–≤–µ–¥–∏—Ç–µ –≤–æ–ø—Ä–æ—Å –Ω–∏–∂–µ
                    </div>
                </div>

                <div style="display: flex; gap: 14px; animation: slideUp 0.5s ease-out;">
                    <input
                        type="text"
                        id="chatInput"
                        placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å..."
                        style="
                            flex: 1;
                            padding: 15px 20px;
                            background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(52, 211, 153, 0.1));
                            border: 1.5px solid rgba(16, 185, 129, 0.3);
                            border-radius: 12px;
                            color: #ffffff;
                            font-size: 14px;
                            transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
                            box-shadow: 0 4px 16px rgba(16, 185, 129, 0.12), inset 0 1px 2px rgba(52, 211, 153, 0.2);
                            font-family: 'Segoe UI', sans-serif;
                            letter-spacing: 0.3px;
                        "
                        onkeydown="if(event.key==='Enter') sendChatMessage()"
                        onfocus="this.style.borderColor='#10b981'; this.style.boxShadow='0 6px 24px rgba(16, 185, 129, 0.25), inset 0 1px 2px rgba(52, 211, 153, 0.3)'; this.style.background='linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(52, 211, 153, 0.15))'"
                        onblur="this.style.borderColor='rgba(16, 185, 129, 0.3)'; this.style.boxShadow='0 4px 16px rgba(16, 185, 129, 0.12), inset 0 1px 2px rgba(52, 211, 153, 0.2)'; this.style.background='linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(52, 211, 153, 0.1))'"
                    >
                    <button
                        onclick="sendChatMessage()"
                        style="
                            padding: 15px 36px;
                            background: linear-gradient(135deg, #10b981 0%, #34d399 100%);
                            border: none;
                            border-radius: 12px;
                            color: #0a0e27;
                            cursor: pointer;
                            font-weight: 700;
                            font-size: 14px;
                            transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
                            box-shadow: 0 6px 24px rgba(16, 185, 129, 0.3), 0 0 0 0 rgba(16, 185, 129, 0.3);
                            white-space: nowrap;
                            position: relative;
                            overflow: hidden;
                            font-family: 'Segoe UI', sans-serif;
                            letter-spacing: 0.5px;
                        "
                        onmouseover="this.style.boxShadow='0 8px 32px rgba(16, 185, 129, 0.5), 0 0 20px rgba(16, 185, 129, 0.4)'; this.style.transform='translateY(-3px)'; this.style.animation='buttonPulse 2s ease-in-out infinite'"
                        onmouseout="this.style.boxShadow='0 6px 24px rgba(16, 185, 129, 0.3)'; this.style.transform='translateY(0)'; this.style.animation='none'"
                        onmousedown="this.style.transform='translateY(-1px)'"
                    >
                        ‚úàÔ∏è –û—Ç–ø—Ä–∞–≤–∏—Ç—å
                    </button>
                </div>
            </div>

            <!-- Sensors Tab -->
            <div id="sensors-tab" class="ai-tab-content" style="display: none;">
                <h2 style="color: #10b981; margin-bottom: 20px;">üìä –ò–ò-–∞–Ω–∞–ª–∏–∑ –¥–∞—Ç—á–∏–∫–æ–≤</h2>
                <p style="color: #b0b9d0; margin-bottom: 20px;">–ò–ò –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ pH, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã, —Å–≤–µ—Ç–∞ –∏ –°–û2 ‚Üí –¥–∞—ë—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ —Ñ–æ—Ç–æ—Å–∏–Ω—Ç–µ–∑–∞</p>

                <div style="background: rgba(16, 185, 129, 0.08); border: 1px solid rgba(16, 185, 129, 0.2); border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                    <h3 style="color: #34d399; margin-bottom: 15px;">–¢–µ–∫—É—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç–∞–Ω—Ü–∏–∏:</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div style="background: rgba(16, 185, 129, 0.1); padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="color: #b0b9d0; font-size: 12px;">pH</div>
                            <div style="color: #10b981; font-size: 20px; font-weight: bold; margin: 5px 0;" id="sensorPh">6.45</div>
                        </div>
                        <div style="background: rgba(16, 185, 129, 0.1); padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="color: #b0b9d0; font-size: 12px;">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</div>
                            <div style="color: #10b981; font-size: 20px; font-weight: bold; margin: 5px 0;" id="sensorTemp">22.3¬∞C</div>
                        </div>
                        <div style="background: rgba(16, 185, 129, 0.1); padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="color: #b0b9d0; font-size: 12px;">–°–≤–µ—Ç (–ª—é–∫—Å)</div>
                            <div style="color: #10b981; font-size: 20px; font-weight: bold; margin: 5px 0;" id="sensorLight">450</div>
                        </div>
                        <div style="background: rgba(16, 185, 129, 0.1); padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="color: #b0b9d0; font-size: 12px;">CO2 (ppm)</div>
                            <div style="color: #10b981; font-size: 20px; font-weight: bold; margin: 5px 0;" id="sensorCo2">420</div>
                        </div>
                    </div>

                    <button onclick="analyzeSensors()" style="padding: 12px 30px; background: #10b981; border: none; border-radius: 5px; color: #0a0e27; cursor: pointer; font-weight: bold; margin-bottom: 15px;">ü§ñ –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–Ω–∞–ª–∏–∑ –ò–ò</button>
                </div>

                <div id="sensorAnalysisResult" style="display: none; background: rgba(52, 211, 153, 0.1); border-left: 4px solid #34d399; padding: 20px; border-radius: 8px;">
                    <h3 style="color: #34d399; margin-bottom: 15px;">–†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞:</h3>
                    <p id="analysisText" style="color: #b0b9d0; line-height: 1.6;"></p>
                </div>
            </div>

            <!-- Prediction Tab -->
            <div id="prediction-tab" class="ai-tab-content" style="display: none;">
                <h2 style="color: #10b981; margin-bottom: 20px;">ü§ñ –ò–ò-–ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ —Ä–æ—Å—Ç–∞ –±–∞–ª–¥—ã—Ä–µ–π</h2>
                <p style="color: #b0b9d0; margin-bottom: 20px;">–í–≤–µ–¥–∏—Ç–µ —É—Å–ª–æ–≤–∏—è (pH, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, —Å–≤–µ—Ç) ‚Üí –ò–ò –ø—Ä–µ–¥—Å–∫–∞–∂–µ—Ç —Å–∫–æ–ª—å–∫–æ CO2 –ø–æ–≥–ª–æ—Ç–∏—Ç—Å—è –∑–∞ —á–∞—Å/–¥–µ–Ω—å</p>

                <div style="background: rgba(16, 185, 129, 0.08); border: 1px solid rgba(16, 185, 129, 0.2); border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 20px;">
                        <div>
                            <label style="color: #34d399; display: block; margin-bottom: 8px; font-size: 13px; font-weight: bold;">pH</label>
                            <input type="number" id="predPh" value="6.45" step="0.1" min="6" max="8" style="width: 100%; padding: 10px; background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.2); border-radius: 5px; color: #ffffff;">
                        </div>
                        <div>
                            <label style="color: #34d399; display: block; margin-bottom: 8px; font-size: 13px; font-weight: bold;">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (¬∞C)</label>
                            <input type="number" id="predTemp" value="22.3" step="0.1" min="15" max="30" style="width: 100%; padding: 10px; background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.2); border-radius: 5px; color: #ffffff;">
                        </div>
                        <div>
                            <label style="color: #34d399; display: block; margin-bottom: 8px; font-size: 13px; font-weight: bold;">–°–≤–µ—Ç (–ª—é–∫—Å)</label>
                            <input type="number" id="predLight" value="450" step="10" min="200" max="800" style="width: 100%; padding: 10px; background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.2); border-radius: 5px; color: #ffffff;">
                        </div>
                    </div>

                    <button onclick="predictGrowth()" style="padding: 12px 30px; background: #10b981; border: none; border-radius: 5px; color: #0a0e27; cursor: pointer; font-weight: bold; margin-bottom: 15px;">ü§ñ –ü—Ä–µ–¥—Å–∫–∞–∑–∞—Ç—å —Ä–æ—Å—Ç</button>
                </div>

                <div id="predictionResult" style="display: none; background: rgba(52, 211, 153, 0.1); border-left: 4px solid #34d399; padding: 20px; border-radius: 8px;">
                    <h3 style="color: #34d399; margin-bottom: 15px;">–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –ò–ò:</h3>
                    <p id="predictionText" style="color: #b0b9d0; line-height: 1.6;"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-links">
                <a href="mailto:nurmiko22@gmail.com">üìß Email</a>
                <a href="https://wa.me/77716927216" target="_blank">üì± WhatsApp</a>
                <a href="index-project-v2.html">üìÑ –û –ü—Ä–æ–µ–∫—Ç–µ</a>
            </div>
            <p>&copy; 2024 GreenPulse. –û—á–∏—Å—Ç–∫–∞ –≤–æ–∑–¥—É—Ö–∞ –æ—Ç CO‚ÇÇ. üíö</p>
        </div>
    </footer>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // API –±–∞–∑–æ–≤—ã–π URL - –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å –¥–ª—è —Ä–∞–±–æ—Ç—ã –Ω–∞ –ª—é–±–æ–º –¥–æ–º–µ–Ω–µ
        const API_URL = '/api';

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑/—Å–∫—Ä—ã—Ç–∏—è AI —Ñ—É–Ω–∫—Ü–∏–π
        function toggleAIFunctions() {
            const aiFunctions = document.getElementById('aiFunctions');
            if (aiFunctions.style.display === 'none') {
                aiFunctions.style.display = 'block';
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —á–∞—Ç
                document.getElementById('chatbot-tab').style.display = 'block';
                document.getElementById('sensors-tab').style.display = 'none';
                document.getElementById('prediction-tab').style.display = 'none';
                // –§–æ–∫—É—Å –Ω–∞ —á–∞—Ç –ø–æ–ª–µ
                document.getElementById('chatInput').focus();
            } else {
                aiFunctions.style.display = 'none';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∫–ª–∞–¥–æ–∫
        function switchTab(tabName) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.ai-tab-content').forEach(el => el.style.display = 'none');

            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å
            document.querySelectorAll('.ai-tab').forEach(el => {
                el.style.background = 'transparent';
                el.style.color = '#b0b9d0';
            });

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            document.getElementById(tabName + '-tab').style.display = 'block';

            // –ü–æ–º–µ—á–∞–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
            event.target.style.background = 'rgba(16, 185, 129, 0.2)';
            event.target.style.color = '#10b981';
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —á–∞—Ç–∞
        async function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();

            if (!message) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–æ–ø—Ä–æ—Å');
                return;
            }

            const container = document.getElementById('chatContainer');

            // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –∫—Ä–∞—Å–∏–≤—ã–º–∏ —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏
            const userMsg = document.createElement('div');
            userMsg.className = 'chat-message-user';
            userMsg.style.cssText = `
                background: linear-gradient(135deg, rgba(52, 211, 153, 0.15), rgba(16, 185, 129, 0.1));
                padding: 15px 18px;
                margin: 12px 0;
                border-radius: 12px;
                text-align: right;
                border: 1px solid rgba(52, 211, 153, 0.25);
                box-shadow: 0 4px 12px rgba(16, 185, 129, 0.15), inset 0 1px 0 rgba(52, 211, 153, 0.2);
                backdrop-filter: blur(10px);
            `;
            userMsg.innerHTML = `<strong style="color: #34d399; font-size: 13px;">üë§ –í—ã:</strong><br><span style="color: #e0e0e0; font-size: 14px; line-height: 1.5;">${message}</span>`;
            container.appendChild(userMsg);

            // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
            input.value = '';

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
            const loadingMsg = document.createElement('div');
            loadingMsg.style.cssText = `
                padding: 16px;
                color: #b0b9d0;
                text-align: center;
                font-size: 14px;
                animation: pulse 1.5s ease-in-out infinite;
            `;
            loadingMsg.innerHTML = `<span style="display: inline-block; animation: bounce 1.4s infinite;">‚è≥</span> –ò–ò –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç...`;
            container.appendChild(loadingMsg);

            // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–π
            const style = document.createElement('style');
            style.textContent = `
                @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }
                @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
            `;
            document.head.appendChild(style);
            container.scrollTop = container.scrollHeight;

            try {
                const response = await fetch(`${API_URL}/chatbot`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ message: message })
                });

                const data = await response.json();
                loadingMsg.remove();

                if (data.status === 'success') {
                    const botMsg = document.createElement('div');
                    botMsg.className = 'chat-message-bot';
                    botMsg.style.cssText = `
                        background: linear-gradient(135deg, rgba(16, 185, 129, 0.12), rgba(52, 211, 153, 0.08));
                        padding: 16px 18px;
                        margin: 12px 0;
                        border-radius: 12px;
                        border: 1px solid rgba(16, 185, 129, 0.25);
                        box-shadow: 0 4px 16px rgba(16, 185, 129, 0.15), inset 0 1px 0 rgba(52, 211, 153, 0.15);
                        backdrop-filter: blur(10px);
                    `;
                    botMsg.innerHTML = `<strong style="color: #10b981; font-size: 13px; display: block; margin-bottom: 8px;">ü§ñ GreenPulse AI:</strong><span style="color: #e0e0e0; font-size: 14px; line-height: 1.6; display: block;">${data.response}</span>`;
                    container.appendChild(botMsg);
                } else {
                    const errorMsg = document.createElement('div');
                    errorMsg.style.cssText = `
                        background: linear-gradient(135deg, rgba(239, 68, 68, 0.12), rgba(220, 38, 38, 0.08));
                        padding: 14px 16px;
                        margin: 10px 0;
                        border-radius: 10px;
                        border: 1px solid rgba(239, 68, 68, 0.25);
                        color: #ff7b7b;
                        font-size: 13px;
                        box-shadow: 0 4px 12px rgba(239, 68, 68, 0.1);
                    `;
                    errorMsg.textContent = '‚ùå –û—à–∏–±–∫–∞: ' + data.message;
                    container.appendChild(errorMsg);
                }

                container.scrollTop = container.scrollHeight;

            } catch (error) {
                loadingMsg.remove();
                const errorMsg = document.createElement('div');
                errorMsg.style.cssText = `
                    background: linear-gradient(135deg, rgba(239, 68, 68, 0.12), rgba(220, 38, 38, 0.08));
                    padding: 16px;
                    margin: 12px 0;
                    border-radius: 10px;
                    border: 1px solid rgba(239, 68, 68, 0.25);
                    color: #ff7b7b;
                    font-size: 13px;
                    box-shadow: 0 4px 16px rgba(239, 68, 68, 0.1);
                    line-height: 1.6;
                `;
                errorMsg.innerHTML = `
                    <strong>‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è</strong><br>
                    ${error.message}<br>
                    <small style="color: #ff9999;">–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ Flask —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω: <code style="background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 3px;">python app.py</code></small>
                `;
                container.appendChild(errorMsg);
                console.error('Chat error:', error);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–∞—Ç—á–∏–∫–æ–≤
        async function analyzeSensors() {
            const ph = parseFloat(document.getElementById('sensorPh').textContent) || 6.45;
            const temperature = parseFloat(document.getElementById('sensorTemp').textContent) || 22.3;
            const light = parseFloat(document.getElementById('sensorLight').textContent) || 450;
            const co2 = parseFloat(document.getElementById('sensorCo2').textContent) || 420;

            const resultDiv = document.getElementById('sensorAnalysisResult');
            const resultText = document.getElementById('analysisText');

            resultText.innerHTML = '‚è≥ –ò–ò –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ...';
            resultDiv.style.display = 'block';

            try {
                const response = await fetch(`${API_URL}/ai-analyze-sensors`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        ph: ph,
                        temperature: temperature,
                        light_intensity: light,
                        co2_ppm: co2
                    })
                });

                const data = await response.json();

                if (data.status === 'success') {
                    resultText.innerHTML = data.analysis;
                } else {
                    resultText.innerHTML = '‚ùå –û—à–∏–±–∫–∞: ' + data.message;
                }

            } catch (error) {
                resultText.innerHTML = `‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:<br>${error.message}<br><small>–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ http://localhost:5000</small>`;
                console.error('Analysis error:', error);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è —Ä–æ—Å—Ç–∞
        async function predictGrowth() {
            const ph = parseFloat(document.getElementById('predPh').value) || 6.45;
            const temp = parseFloat(document.getElementById('predTemp').value) || 22.3;
            const light = parseFloat(document.getElementById('predLight').value) || 450;

            const resultDiv = document.getElementById('predictionResult');
            const resultText = document.getElementById('predictionText');

            resultText.innerHTML = '‚è≥ –ò–ò –¥–µ–ª–∞–µ—Ç –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ...';
            resultDiv.style.display = 'block';

            try {
                const response = await fetch(`${API_URL}/ai-predict-growth`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        ph: ph,
                        temperature: temp,
                        light_intensity: light
                    })
                });

                const data = await response.json();

                if (data.status === 'success') {
                    resultText.innerHTML = data.prediction;
                } else {
                    resultText.innerHTML = '‚ùå –û—à–∏–±–∫–∞: ' + data.message;
                }

            } catch (error) {
                resultText.innerHTML = `‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:<br>${error.message}<br><small>–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ http://localhost:5000</small>`;
                console.error('Prediction error:', error);
            }
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–∞—Ç—á–∏–∫–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        let mapInitialized = false;
        let map = null;
        let marker = null;
        let coverageCircle = null;

        async function loadSensorData() {
            try {
                const response = await fetch(`${API_URL}/sensor-data`);
                const data = await response.json();

                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞—Ç—á–∏–∫–∏ –≤ –∞–Ω–∞–ª–∏–∑–µ
                document.getElementById('sensorPh').textContent = data.ph ? data.ph.toFixed(2) : '6.5';
                document.getElementById('sensorTemp').textContent = data.temperature ? data.temperature.toFixed(1) + '¬∞C' : '22¬∞C';
                document.getElementById('sensorLight').textContent = data.light_intensity || 450;
                document.getElementById('sensorCo2').textContent = data.co2_ppm || 420;

                // –ì–õ–ê–í–ù–û–ï: –µ—Å–ª–∏ –ø—Ä–∏—à–ª–∏ GPS –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã, –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞–Ω—Ü–∏—é!
                if (data.latitude && data.longitude) {
                    updateStationLocation(data);
                }

            } catch (error) {
                console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–∞—Ç—á–∏–∫–æ–≤. –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–µ–º–æ –¥–∞–Ω–Ω—ã–µ.');
            }
        }

        // Station data (–Ω–∞—á–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è)
        const station = {
            id: 1,
            name: 'GreenPulse Station 01',
            lat: 55.7558,    // –ú–æ—Å–∫–≤–∞ (–¥–µ–º–æ)
            lng: 37.6173,
            status: 'active',
            repairTime: null,
            ph: 6.50,
            temperature: 22,
            radiusKm: 0.8,
            population: 15000,
            co2Daily: 0.104,
            co2Yearly: 38,
            efficiency: 92,
            satellites: 0,
            humidity: 65,
            altitude: 150
        };

        // –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞–Ω—Ü–∏–∏ –∫–æ–≥–¥–∞ –ø—Ä–∏—Ö–æ–¥—è—Ç GPS –¥–∞–Ω–Ω—ã–µ —Å ESP32!
        function updateStationLocation(data) {
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ —Å—Ç–∞–Ω—Ü–∏–∏
            station.lat = data.latitude || station.lat;
            station.lng = data.longitude || station.lng;
            station.name = data.station_name || 'GreenPulse Station 01';
            station.temperature = data.temperature || station.temperature;
            station.humidity = data.humidity || station.humidity;
            station.altitude = data.altitude || station.altitude;
            station.satellites = data.satellites || 0;
            station.ph = data.ph || station.ph;

            console.log(`üìç –û–ë–ù–û–í–õ–ï–ù–ò–ï –°–¢–ê–ù–¶–ò–ò: ${station.lat.toFixed(4)}, ${station.lng.toFixed(4)}`);
            console.log(`üõ∞Ô∏è  –°–ø—É—Ç–Ω–∏–∫–æ–≤: ${station.satellites}`);

            // –ï—Å–ª–∏ –∫–∞—Ä—Ç–∞ —É–∂–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞, –æ–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –º–∞—Ä–∫–µ—Ä–∞ –∏ –∫—Ä—É–≥–∞
            if (mapInitialized && map && marker && coverageCircle) {
                // –ü–µ—Ä–µ–º–µ—â–∞–µ–º –º–∞—Ä–∫–µ—Ä
                marker.setLatLng([station.lat, station.lng]);

                // –ü–µ—Ä–µ–º–µ—â–∞–µ–º –∫—Ä—É–≥ –ø–æ–∫—Ä—ã—Ç–∏—è
                coverageCircle.setLatLng([station.lat, station.lng]);

                // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É –Ω–∞ –Ω–æ–≤–æ–π –ø–æ–∑–∏—Ü–∏–∏
                map.setView([station.lat, station.lng], 12);

                // –û–±–Ω–æ–≤–ª—è–µ–º popup
                marker.setPopupContent(`<strong>${station.name}</strong><br>üìç ${station.lat.toFixed(4)}, ${station.lng.toFixed(4)}<br>üõ∞Ô∏è –°–ø—É—Ç–Ω–∏–∫–æ–≤: ${station.satellites}<br>–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π`);

                console.log('‚úÖ –°—Ç–∞–Ω—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –Ω–∞ –∫–∞—Ä—Ç–µ!');
            }
        }

        // Initialize map
        const map_instance = L.map('map').setView([station.lat, station.lng], 12);
        map = map_instance;

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap',
            maxZoom: 19
        }).addTo(map);

        // Add coverage circle
        const circle = L.circle([station.lat, station.lng], {
            radius: station.radiusKm * 1000,
            color: '#10b981',
            weight: 2,
            opacity: 0.3,
            fillColor: '#10b981',
            fillOpacity: 0.05,
            dashArray: '5, 5'
        }).addTo(map);
        coverageCircle = circle;

        // Add marker
        const statusColor = {
            active: '#10b981',
            repair: '#f59e0b',
            inspect: '#3b82f6'
        };

        const station_marker = L.circleMarker([station.lat, station.lng], {
            radius: 12,
            fillColor: statusColor[station.status],
            color: '#ffffff',
            weight: 2,
            opacity: 1,
            fillOpacity: 0.8
        }).addTo(map);
        marker = station_marker;

        marker.bindPopup(`<strong>${station.name}</strong><br>üìç ${station.lat.toFixed(4)}, ${station.lng.toFixed(4)}<br>üõ∞Ô∏è –°–ø—É—Ç–Ω–∏–∫–æ–≤: ${station.satellites}<br>–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π`, {
            closeButton: false
        }).on('click', openModal);

        mapInitialized = true;

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–∞—Ç—á–∏–∫–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç–∞–Ω–∏—Ü—ã
        loadSensorData();

        // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ (–∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥)
        setInterval(loadSensorData, 30000);

        // Modal logic
        const modal = document.getElementById('stationModal');
        const closeBtn = document.querySelector('.close');

        function openModal() {
            document.getElementById('modalTitle').textContent = station.name;

            const statusText = {
                active: '‚úÖ –ê–∫—Ç–∏–≤–Ω–∞',
                repair: 'üîß –¢—Ä–µ–±—É–µ—Ç —Ä–µ–º–æ–Ω—Ç–∞',
                inspect: 'üìã –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–±—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ'
            };

            let statusHtml = `<div class="status-badge status-${station.status}">${statusText[station.status]}</div>`;
            if (station.repairTime) {
                statusHtml += `<p style="font-size: 12px; color: #b0b9d0; margin-top: 8px;">–ü—Ä–∏–º–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è: ${station.repairTime}</p>`;
            }

            // –î–æ–±–∞–≤–ª—è–µ–º GPS –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
            if (station.satellites && station.satellites > 0) {
                statusHtml += `<p style="font-size: 12px; color: #34d399; margin-top: 8px;">üìç GPS: ${station.lat.toFixed(4)}, ${station.lng.toFixed(4)}</p>`;
                statusHtml += `<p style="font-size: 12px; color: #34d399;">üõ∞Ô∏è –°–ø—É—Ç–Ω–∏–∫–æ–≤: ${station.satellites}</p>`;
                statusHtml += `<p style="font-size: 12px; color: #34d399;">üìè –í—ã—Å–æ—Ç–∞: ${station.altitude.toFixed(1)} –º</p>`;
            }

            document.getElementById('statusContent').innerHTML = statusHtml;
            document.getElementById('modalPh').textContent = station.ph ? station.ph.toFixed(2) : '6.5';
            document.getElementById('modalTemp').textContent = station.temperature ? station.temperature + '¬∞C' : '22¬∞C';

            modal.style.display = 'block';
        }

        closeBtn.onclick = () => modal.style.display = 'none';
        window.onclick = (e) => {
            if (e.target === modal) modal.style.display = 'none';
        };
    </script>
</body>
</html>
